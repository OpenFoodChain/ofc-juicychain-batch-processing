name: Push to Master Actions
on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # Run in all these versions of Python
        python-version: [3.9]
    steps:
      - name: Check out repository code
        uses: actions/checkout@v2
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}

      - run: |
             sudo apt install libcurl4-gnutls-dev
             sudo apt-get install libgnutls28-dev
      - name: Checkout submodules # checkout rest
        shell: bash
#         run: git submodule update --init --recursive
        run: |
          git config --file .gitmodules --get-regexp url | while read url; do
            git config --file=.gitmodules $(echo "$url" | sed -E "s/git@github.com:|https:\/\/github.com\//https:\/\/${{ secrets.CI_PAT }}:${{ secrets.CI_PAT }}@github.com\//")
          done
          git submodule sync --recursive
          git -c "http.extraheader=$auth_header" -c protocol.version=2 submodule update --init --force --recursive --depth=1
      - name: Set Up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
       # Display the Python version being used
      - name: Display Python version
        run: python -c "import sys; print(sys.version)"
         # Install the package using the setup.py
      - name: Install package
        run:  python -m pip install -r requirements.txt
      - name: Install pytest
        run: |
          python -m pip install --upgrade pip
          pip install pytest
      - name: do python simple tests
        run: python -m pytest test_lib_juicychain.py
